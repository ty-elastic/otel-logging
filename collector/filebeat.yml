receivers:
  otlp:
    protocols:
      grpc:
  filelog:
    include: [ logs/otel.log ]
    operators:
      - type: json_parser
        timestamp:
          parse_from: attributes.Timestamp
          layout_type: strptime
          location: UTC
          layout: '%Y-%m-%dT%H:%M:%S.%fZ'
        severity:
          parse_from: attributes.SeverityText
        body: attributes.Body
        trace:
          trace_id:
            parse_from: attributes.TraceId
          span_id:
            parse_from: attributes.SpanId
        scope_name:
          parse_from: attributes.ServiceName
      - type: copy
        from: attributes.ServiceName
        to: resource["service.name"]
      - type: remove
        field: attributes.Timestamp
      - type: remove
        field: attributes.Body
      - type: remove
        field: attributes.SeverityText
      - type: remove
        field: attributes.ServiceName
      - type: remove
        field: attributes.TraceId
      - type: remove
        field: attributes.SpanId
processors:
  batch:

exporters:
  logging:
    verbosity: detailed
  otlphttp/elastic: 
    # Elastic APM server https endpoint without the "https://" prefix
    endpoint: "${ELASTIC_APM_SERVER_ENDPOINT}"
    compression: none
    headers:
      # Elastic APM Server secret token
      Authorization: "Bearer ${ELASTIC_APM_SERVER_SECRET}"  

service:
  pipelines:
    traces:
      receivers: [ otlp ]
      processors: [ batch ]
      exporters: [ logging, otlphttp/elastic]
    metrics:
      receivers: [ otlp ]
      processors: [ batch ]
      exporters: [ logging, otlphttp/elastic]
    # logs:
    #   receivers: [ otlp ]
    #   processors: [ batch ]
    #   exporters: [ logging, otlphttp/elastic]